let totalPrice=0;function countItemsSelected(){return Array.from(document.getElementById("productsSelectedRows").children).length}function removeProductToTable(e){const t=document.getElementById("productsSelectedRows").getElementsByClassName("row-"+e)[0];document.getElementById("productsSelectedRows").removeChild(t)}function setTotalPrice(){document.getElementsByName("final_price")[0].value=calculateTotalPrice().toFixed(2)}function calculateTotalPrice(){return Array.from(document.getElementById("productsSelectedRows").children).reduce((function(e,t){let n=0,a=0;return Array.from(t.children).forEach((function(e){"unitPrice"==e.name&&(a=e.dataset.unitPrice),"quantity"==e.name&&(n=e.dataset.quantity)})),e+a*n}),0)}function createRow(e,t){let n=document.createElement("tr");n.name="product_id",n.className="row-"+e.id;let a=document.createElement("td");a.name="productSku",a.innerHTML=e.sku;let c=document.createElement("td");c.name="productName",c.innerHTML=e.name;let o=document.createElement("td");o.name="unitPrice",o.innerHTML=e.unitPrice+" ("+e.currency+")",o.dataset.unitPrice=e.unitPrice;let d=document.createElement("td");d.name="quantity",d.innerHTML=t,d.dataset.quantity=t;let r=document.createElement("td");const l=(e.unitPrice*t).toFixed(2);r.name="subtotal",r.innerHTML=l+" ("+e.currency+")",r.dataset.subtotal=l;let i=document.createElement("td"),u=document.createElement("button");u.className="remove-button btn btn-sm",u.type="button",u.id="remove-button-"+e.id,u.dataset.id=e.id;let s=document.createElement("i");return s.className="fa fa-trash",u.appendChild(s),i.appendChild(u),n.appendChild(a),n.appendChild(c),n.appendChild(o),n.appendChild(d),n.appendChild(r),n.appendChild(i),n}function addProductToTable(e,t,n){if(0==document.getElementsByClassName("row-"+e.id).length){const n=createRow(e,t);$("#productsSelectedRows").append(n),$("button[id^='remove-button-']").click((function(e){removeProductToTable(e.currentTarget.dataset.id),setTotalPrice(),0==countItemsSelected()?($("#notItemsMessage").css("display",""),$("#productsSelected").css("display","none")):($("#notItemsMessage").css("display","none"),$(".table.table-hover").css("display",""))})),setTotalPrice()}else alert("El producto ya esta agregado al pedido, eliminelo e agreguelo nuevamente si quiere cambiar la cantidad")}function createInputsToSubmit(e,t,n,a){const c=document.createElement("input"),o=document.createElement("input"),d=document.createElement("input");c.name=`products[${a}][id]`,c.value=e,o.name=`products[${a}][quantity]`,o.value=n,d.name=`products[${a}][unit_price]`,d.value=t,document.getElementById("productsOrder").appendChild(c),document.getElementById("productsOrder").appendChild(o),document.getElementById("productsOrder").appendChild(d)}function setProductsOrderRequest(){Array.from(document.getElementById("productsSelectedRows").children).forEach((function(e,t){const n=e.className.replace("row-","");let a=0;Array.from(e.children).forEach((function(e){"unitPrice"==e.name&&(unitPrice=e.dataset.unitPrice),"quantity"==e.name&&(a=e.dataset.quantity)})),createInputsToSubmit(n,unitPrice,a,t)}))}function fillItemsTable(){if(void 0!==document.getElementsByName("items")[0]){let e=document.getElementById("productsSelected"),t=document.getElementsByName("items")[0].value;JSON.parse(t).forEach((t=>{addProductToTable(t,t.quantity,e)})),$("#productsSelected").css("display",""),$("#notItemsMessage").css("display","none")}}function changeStatusShippingSelect(){document.getElementsByName("shipping_id")[0].disabled=1==document.getElementById("sale").selectedOptions[0].value}$(document).ready((function(){var e;$(".form-control-selectajax").select2({ajax:{url:$(".form-control-selectajax").attr("data-url"),dataType:"json",delay:250,method:"POST",data:function(e){return{_token:$('input[name ="_token"]').val(),filter_search:e.term,page:e.page,currency_id:$("#currency").val(),organization_id:$("#organization_id").val()}},processResults:function(e,t){return t.page=t.page||1,{results:e.data.data,pagination:{more:30*t.page<e.total_count}}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1,templateResult:function(e){if(e.loading)return e.text;var t=$(".form-control-selectajax").attr("data-template");return Fulljaus[t](e)},templateSelection:function(e){return e.name||e.text}}),changeStatusShippingSelect(),fillItemsTable(),0==countItemsSelected()&&($("#notItemsMessage").css("display",""),$("#productsSelected").css("display","none")),$("#currency").on("select2:selecting",(function(t){e=$(this).val()})),$("#currency").on("select2:select",(function(t){$("#product_id").empty(),$("#quantity").val(1),countItemsSelected()>0&&swal({title:"¿Desea cambiar la moneda?",icon:"warning",closeOnClickOutside:!1,text:"Si cambia la moneda se vaciará el listado de productos seleccionados",buttons:{cancel:"Cancelar",confirm:"Cambiar"}}).then((t=>{t?$(".remove-button").each(((e,t)=>{t.click()})):$(this).select2("val",e)}))})),$("#sale").change((function(e){changeStatusShippingSelect()})),$(".btn.btn-primary").click((function(e){setProductsOrderRequest()})),$(".btn.btn-success").click((function(e){setProductsOrderRequest()})),$("#addProductToCart").click((function(e){let t=$("#product_id").select2("data")[0],n=$("#quantity").val();""!==t.id&&n>0&&(addProductToTable(t,n,document.getElementById("productsSelected")),$("#product_id").empty(),$("#quantity").val(1),$("#productsSelected").css("display",""),$("#notItemsMessage").css("display","none"))}))}));